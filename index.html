<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>بطولة كأس منصور بن زايد 2026</title>

  <style>
    :root{
      --bg:#071022;
      --bg2:#0b1220;
      --card:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.12);
      --text:#e8eefc;
      --muted:rgba(232,238,252,.7);
      --accent:#f6c445;
      --accent2:rgba(246,196,69,.18);
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius:18px;
      --max:1100px;
    }
    *{ box-sizing:border-box; font-family: system-ui,-apple-system,"Segoe UI",Tahoma,Arial,sans-serif;}
    body{
      margin:0;
      color:var(--text);
      background: linear-gradient(180deg, var(--bg) 0%, #0b1220 50%, var(--bg) 100%);
      min-height:100vh;
    }
    a{ color:inherit; text-decoration:none; }
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(7,16,34,.78);
      border-bottom:1px solid var(--line);
    }
    .topbar-inner{
      max-width:var(--max);
      margin:0 auto;
      padding:10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{ display:flex; align-items:center; gap:10px; min-width:260px; }
    .brand img{ height:42px; width:auto; border-radius:10px; }
    .brand .title{ line-height:1.15; }
    .brand .title b{ display:block; font-size:15px; }
    .brand .title span{ display:block; font-size:12px; color:var(--muted); }

    nav{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
    .tab{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding:8px 10px;
      border-radius:999px;
      cursor:pointer;
      font-size:13px;
      transition:.15s;
    }
    .tab:hover{ border-color:rgba(246,196,69,.55); }
    .tab.active{ border-color:rgba(246,196,69,.55); box-shadow:0 0 0 2px rgba(246,196,69,.12) inset; }

    .wrap{ max-width:var(--max); margin:0 auto; padding:18px 14px 28px; }
    .hero{
      border:1px solid var(--line);
      background:
        radial-gradient(1200px 600px at 80% 30%, rgba(246,196,69,.18), transparent 60%),
        linear-gradient(135deg, rgba(11,42,111,.92), rgba(9,24,66,.88));
      border-radius:var(--radius);
      padding:26px 18px;
      box-shadow:var(--shadow);
      text-align:center;
    }
    .hero h1{ margin:0 0 8px; font-size:28px; }
    .hero p{ margin:0; color:var(--muted); }

    .grid{ display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px; margin-top:14px; }
    @media (max-width: 980px){ .grid{ grid-template-columns: repeat(3,1fr);} }
    @media (max-width: 740px){ .grid{ grid-template-columns: repeat(2,1fr);} }
    @media (max-width: 520px){ .grid{ grid-template-columns: 1fr;} }

    .card{
      border:1px solid var(--line);
      background: var(--card);
      border-radius:16px;
      padding:12px;
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
    }
    .card b{ display:block; font-size:15px; margin-bottom:6px; }
    .card .meta{ color:var(--muted); font-size:12px; }

    .section-title{
      margin:18px 0 10px;
      font-size:18px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(246,196,69,.35);
      background: var(--accent2);
      color: #ffd98d;
      font-size:12px;
    }

    .hidden{ display:none; }
    .footer{
      max-width:var(--max);
      margin:14px auto 30px;
      padding:0 14px;
      color:rgba(232,238,252,.55);
      text-align:center;
      font-size:12px;
    }
    .error{
      border-color: rgba(255,90,90,.55) !important;
      background: rgba(255,90,90,.10) !important;
      color: #ffd1d1 !important;
    }

    /* Players filter bar */
    .filterbar{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius:14px;
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top:12px;
    }
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
    }
    .btn:hover{ border-color: rgba(246,196,69,.55); }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <!-- لو عندك شعار داخل assets ضع مساره هنا -->
        <img src="assets/logo.png" alt="logo" onerror="this.style.display='none'">
        <div class="title">
          <b>كأس منصور بن زايد</b>
          <span>بطولة 2026 • نسخة تجريبية للعرض</span>
        </div>
      </div>

      <nav>
        <button class="tab active" data-page="home">الرئيسية</button>
        <button class="tab" data-page="teams">الفرق</button>
        <button class="tab" data-page="players">اللاعبين</button>
        <button class="tab" data-page="matches">المباريات</button>
        <button class="tab" data-page="groups">المجموعات</button>
        <button class="tab" data-page="news">الأخبار</button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section id="home-page">
      <div class="hero">
        <h1>بطولة كأس منصور بن زايد 2026</h1>
        <p>واجهة عرض مرتبطة بـ Google Sheets (Publish to web) — تُحدّث بالبيانات عند تحديث الشيت ثم عمل Refresh للصفحة.</p>
      </div>

      <div class="section-title">حالة الربط <span id="status-badge" class="badge">جاهز — انتظر تحميل البيانات…</span></div>
      <div id="status-box" class="card">
        <b>ملاحظة</b>
        <div class="meta">
          إذا ظهرت أخطاء: غالبًا السبب أن الشيت غير منشور للويب أو Published ID / gid غير صحيحين.
        </div>
      </div>
    </section>

    <section id="teams-page" class="hidden">
      <div class="section-title">الفرق</div>
      <div id="teams-container" class="grid"></div>
    </section>

    <section id="players-page" class="hidden">
      <div class="section-title">اللاعبين</div>
      <div id="players-filter" class="filterbar hidden">
        <div>عرض لاعبي فريق: <b id="players-team-name"></b></div>
        <button class="btn" id="clear-filter">إلغاء الفلترة</button>
      </div>
      <div id="players-container" class="grid"></div>
    </section>

    <section id="matches-page" class="hidden">
      <div class="section-title">المباريات</div>
      <div id="matches-container" class="grid"></div>
    </section>

    <section id="groups-page" class="hidden">
      <div class="section-title">المجموعات</div>
      <div id="groups-container" class="grid"></div>
    </section>

    <section id="news-page" class="hidden">
      <div class="section-title">الأخبار</div>
      <div id="news-container" class="grid"></div>
    </section>
  </main>

  <div class="footer">© 2026 جميع الحقوق محفوظة • كأس منصور بن زايد</div>

<script>
/**
 * ✅ هذا الملف يعمل بطريقة واحدة فقط: Google Sheets CSV (Publish to web)
 * ممنوع تكرار const SHEET_PUB_ID أو const SHEETS_CONFIG مرة ثانية.
 */

/* 1) ضع Published ID من رابط pubhtml هنا (يبدأ بـ 2PACX-...) */
const SHEET_PUB_ID = "ضع_Published_ID_هنا";

/* 2) ضع gid لكل شيت هنا (من نفس ملف Google Sheets) */
const SHEETS_CONFIG = {
  teams:   { gid: "624074873",  nameCol: 0 },
  players: { gid: "374566661",  nameCol: 0, teamCol: 1 }, // teamCol عدله حسب عمود الفريق في شيت اللاعبين
  matches: { gid: "140432292",  nameCol: 0 },
  groups:  { gid: "77308583",   nameCol: 0 },
  news:    { gid: "1073137346", nameCol: 0 }
};

let selectedTeam = "";

function setStatus(ok, msg){
  const badge = document.getElementById("status-badge");
  const box = document.getElementById("status-box");
  if(!badge || !box) return;
  badge.textContent = msg;
  if(ok){
    badge.classList.remove("error");
    box.classList.remove("error");
  }else{
    badge.classList.add("error");
    box.classList.add("error");
  }
}

function escapeHtml(str) {
  return String(str ?? "")
    .replace(/&/g, "&amp;").replace(/</g, "&lt;")
    .replace(/>/g, "&gt;").replace(/"/g, "&quot;")
    .replace(/'/g, "&#39;");
}

/* CSV parser بسيط يدعم الاقتباس */
function parseCSV(text) {
  const rows = [];
  let row = [], cur = "", inQuotes = false;
  for (let i = 0; i < text.length; i++) {
    const ch = text[i], next = text[i+1];
    if (ch === '"' && next === '"') { cur += '"'; i++; continue; }
    if (ch === '"') { inQuotes = !inQuotes; continue; }
    if (!inQuotes && ch === ",") { row.push(cur); cur = ""; continue; }
    if (!inQuotes && (ch === "\n" || ch === "\r")) {
      if (ch === "\r" && next === "\n") i++;
      row.push(cur);
      if (row.some(c => c.trim() !== "")) rows.push(row);
      row = []; cur = "";
      continue;
    }
    cur += ch;
  }
  row.push(cur);
  if (row.some(c => c.trim() !== "")) rows.push(row);
  return rows;
}

async function fetchSheetCSV(gid){
  const url = `https://docs.google.com/spreadsheets/d/e/${SHEET_PUB_ID}/pub?gid=${gid}&single=true&output=csv&cachebust=${Date.now()}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error("HTTP " + res.status);
  return await res.text();
}

function showPage(pageId){
  ["home","teams","players","matches","groups","news"].forEach(id=>{
    const el = document.getElementById(id+"-page");
    if(el) el.classList.toggle("hidden", id !== pageId);
  });

  document.querySelectorAll(".tab").forEach(btn=>{
    btn.classList.toggle("active", btn.dataset.page === pageId);
  });

  if(pageId !== "home") loadPageData(pageId);
}

async function loadPageData(pageId){
  const cfg = SHEETS_CONFIG[pageId];
  const container = document.getElementById(pageId + "-container");
  if(!cfg || !container) return;

  container.innerHTML = `<div class="card" style="grid-column:1/-1; text-align:center;">جاري التحميل…</div>`;

  try{
    if(!SHEET_PUB_ID || SHEET_PUB_ID.includes("ضع_")){
      setStatus(false, "خطأ: ضع Published ID الصحيح في الكود");
      container.innerHTML = `<div class="card error" style="grid-column:1/-1; text-align:center;">ضع Published ID الصحيح داخل الكود.</div>`;
      return;
    }

    const csv = await fetchSheetCSV(cfg.gid);
    const table = parseCSV(csv);
    const header = table[0] || [];
    const rows = table.slice(1);

    container.innerHTML = "";
    let count = 0;

    for(const r of rows){
      const name = (r[cfg.nameCol] || "").trim();
      if(!name) continue;
      count++;

      if(pageId === "teams"){
        const safe = escapeHtml(name);
        container.insertAdjacentHTML("beforeend", `
          <button class="card" style="cursor:pointer; text-align:center;"
            onclick="selectTeam('${safe.replace(/&#39;/g, "\\'")}')">
            <b>${safe}</b>
            <div class="meta">اضغط لعرض لاعبي الفريق</div>
          </button>
        `);
      }
      else if(pageId === "players"){
        const team = (r[cfg.teamCol] || "").trim();
        const show = !selectedTeam || team === selectedTeam;
        container.insertAdjacentHTML("beforeend", `
          <div class="card" data-team="${escapeHtml(team)}" style="text-align:center; ${show ? "" : "display:none;"}">
            <b>${escapeHtml(name)}</b>
            <div class="meta">${team ? escapeHtml(team) : ""}</div>
          </div>
        `);
      }
      else{
        container.insertAdjacentHTML("beforeend", `
          <div class="card" style="text-align:center;">
            <b>${escapeHtml(name)}</b>
          </div>
        `);
      }
    }

    if(count === 0){
      container.innerHTML = `<div class="card" style="grid-column:1/-1; text-align:center;">لا توجد بيانات لعرضها</div>`;
    }

    // Filter bar update
    if(pageId === "players"){
      const fb = document.getElementById("players-filter");
      const tn = document.getElementById("players-team-name");
      if(selectedTeam){
        fb.classList.remove("hidden");
        tn.textContent = selectedTeam;
      }else{
        fb.classList.add("hidden");
        tn.textContent = "";
      }
    }

    setStatus(true, "تم تحميل البيانات — Refresh سيظهر أي تحديث في الشيت");

  }catch(e){
    console.error(e);
    setStatus(false, "فشل التحميل — تأكد من Publish to web + gid + Published ID");
    container.innerHTML = `<div class="card error" style="grid-column:1/-1; text-align:center;">
      فشل تحميل البيانات. السبب غالبًا: الشيت غير منشور للويب أو Published ID / gid غير صحيحين.
    </div>`;
  }
}

// team click -> open players with filter
window.selectTeam = function(teamName){
  selectedTeam = (teamName || "").trim();
  showPage("players");
};

// clear filter
document.getElementById("clear-filter").addEventListener("click", ()=>{
  selectedTeam = "";
  showPage("players");
});

// nav
document.querySelectorAll(".tab").forEach(btn=>{
  btn.addEventListener("click", ()=> showPage(btn.dataset.page));
});

// start
document.addEventListener("DOMContentLoaded", ()=> showPage("home"));
</script>
</body>
</html>
